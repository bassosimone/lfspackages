#!/bin/bash

set -euo pipefail

. lib/core.bash

printdeps() (
    local dir_name=$1

    if [[ ! -f $dir_name/package.bash ]]; then
        echo "FATAL: $dir_name/package.bash: no such file or directory" 1>&2
        exit 1
    fi

    . $dir_name/package.bash

    for dep in $(pkg_print_deps); do
        echo "$dep"
        printdeps $dep
    done
)

for arg in "$@"; do
    if [[ "$arg" == "-h" || "$arg" == "--help" ]]; then
        echo ""
        echo "Prints dependencies of the given packages."
        echo ""
        echo "usage: $0: dep..."
        echo ""
        echo "example: $0 ./ports/*/*/*"
        echo ""
        exit 0
    fi
done

while [[ $# -gt 0 ]]; do
    echo $1: $(printdeps $1 | sort -u)
    shift
done
